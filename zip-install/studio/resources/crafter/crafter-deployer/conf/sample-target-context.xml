<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

	<bean id="SampleTarget" class="org.craftercms.cstudio.publishing.target.PublishingTarget" init-method="register">
		<property name="name"><value>Sample</value></property>
		<property name="manager" ref="TargetManager"/>
		<property name="postProcessors">
			<list>
				<ref bean="SampleSearchIndexingProcessor"/>
				<ref bean="SampleCacheInvalidateProcessor"/>
			</list>
		</property>
		<property name="params">
			<map>
				<entry key="root"><value>target/sample</value></entry>
				<entry key="contentFolder"><value>content</value></entry>
				<entry key="metadataFolder"><value>metadata</value></entry>
			</map>
		</property>
	</bean>

	<bean id="SampleSearchService"
		  class="org.craftercms.search.service.impl.RestClientSearchService">
		<property name="serverUrl" value="http://localhost:8080/crafter-search" />
	</bean>

	<bean id="SampleCacheInvalidateProcessor"
		  class="org.craftercms.cstudio.publishing.processor.HttpMethodCallPostProcessor">
		<property name="url" value="http://localhost:9292/api/1/cache/clear_all" />
		<property name="method" value="GET"/>
	</bean>

	<bean id="SampleSearchIndexingProcessor"
		  class="org.craftercms.cstudio.publishing.processor.SearchIndexingProcessor">
		<property name="ignoreIndexId" value="true"/>
		<property name="searchService" ref="SampleSearchService" />
		<property name="batchIndexers">
			<list>
				<ref bean="SampleXmlFileBatchIndexer"/>
				<ref bean="SampleBinaryFileBatchIndexer"/>
				<ref bean="SampleBinaryFileWithMetadataBatchIndexer"/>
			</list>
		</property>
	</bean>

	<bean id="SampleXmlFileBatchIndexer"
		  class="org.craftercms.search.batch.impl.XmlFileBatchIndexer">
		<property name="searchService" ref="SampleSearchService" />
		<property name="itemProcessors">
			<list>
				<ref bean="crafter.flatteningProcessor"/>
			</list>
		</property>
	</bean>

	<bean id="SampleBinaryFileBatchIndexer" class="org.craftercms.search.batch.impl.BinaryFileBatchIndexer">
		<property name="searchService" ref="SampleSearchService"/>
		<property name="supportedMimeTypes">
			<list>
				<value>application/pdf</value>
			</list>
		</property>
	</bean>

	<bean id="SampleBinaryFileWithMetadataBatchIndexer" class="org.craftercms.search.batch.impl.BinaryFileWithMetadataBatchIndexer">
		<property name="searchService" ref="SampleSearchService"/>
		<property name="excludeMetadataProperties">
			<list>
				<value>binary</value>
			</list>
		</property>
		<property name="binaryPathPatterns">
			<list>
				<value>/static-assets/attachment/([^&lt;"'\)]+)</value>
			</list>
		</property>
		<property name="metadataPathPatterns">
			<list>
				<value>/site/components/attachment/([^&lt;]+).xml</value>
			</list>
		</property>
		<property name="referenceXPaths">
			<list>
				<value>//binary/item/value</value>
			</list>
		</property>
	</bean>

</beans>